<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Letters 관리 (모바일 최적화)</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #111; color: white; }
input, button { font-size: 16px; padding: 10px; }
input#letterInput { width: 60%; max-width: 300px; margin-right: 5px; }
button { cursor: pointer; margin: 5px 2px; border-radius: 3px; }

ul { list-style: none; padding: 0; margin-top: 20px; }
li {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  margin-bottom: 10px;
  background: #222;
  padding: 5px;
  border-radius: 5px;
}
li button { margin: 2px; flex-shrink: 0; }
li span { flex: 1 1 auto; word-break: break-word; margin-left: 5px; }
li input.edit-input { flex: 1 1 auto; margin-left: 5px; display: none; }

.edit-btn { background: #0a84ff; color: white; border: none; }
.delete-btn { background: red; color: white; border: none; }
.save-btn { background: #28a745; color: white; border: none; }

@media (max-width: 480px) {
  input#letterInput { width: 100%; margin-bottom: 10px; }
  li { flex-direction: row; align-items: center; }
  li span, li input.edit-input { flex: 1 1 70%; margin-left: 5px; }
  li button { flex: 0 0 auto; margin: 2px 2px 2px 0; }
}
</style>
</head>
<body>

<h2>Letters 관리</h2>

<input type="text" id="letterInput" placeholder="글자 입력" />
<button id="addBtn">등록</button>

<ul id="lettersList"></ul>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAQGtOEcxFxl9FV7NASLgxLDc23u2vzS_0",
  authDomain: "mygps-11798.firebaseapp.com",
  projectId: "mygps-11798",
  storageBucket: "mygps-11798.firebasestorage.app",
  messagingSenderId: "271371741627",
  appId: "1:271371741627:web:642901f43c5ad57d80bc9e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const lettersCol = collection(db, "letters");
const lettersList = document.getElementById("lettersList");

// 글자 등록
document.getElementById("addBtn").addEventListener("click", async () => {
  const text = document.getElementById("letterInput").value.trim();
  if (!text) return alert("글자를 입력하세요.");
  await addDoc(lettersCol, { text, timestamp: Date.now() });
  document.getElementById("letterInput").value = "";
  loadLetters();
});

// 글자 삭제
async function deleteLetter(id) {
  await deleteDoc(doc(db, "letters", id));
  loadLetters();
}

// 글자 수정 (인라인)
async function saveEdit(id, inputEl, spanEl) {
  const newText = inputEl.value.trim();
  if (!newText) return;
  await updateDoc(doc(db, "letters", id), { text: newText });
  spanEl.textContent = newText;
  inputEl.style.display = "none";
  spanEl.style.display = "block";
}

// 글자 목록 불러오기
async function loadLetters() {
  lettersList.innerHTML = "";
  const q = query(lettersCol, orderBy("timestamp", "asc"));
  const snapshot = await getDocs(q);
  snapshot.forEach(docSnap => {
    const li = document.createElement("li");

    // 버튼 먼저 배치
    const editBtn = document.createElement("button");
    editBtn.textContent = "수정";
    editBtn.className = "edit-btn";

    const saveBtn = document.createElement("button");
    saveBtn.textContent = "저장";
    saveBtn.className = "save-btn";

    const delBtn = document.createElement("button");
    delBtn.textContent = "삭제";
    delBtn.className = "delete-btn";

    const span = document.createElement("span");
    span.textContent = docSnap.data().text;

    const input = document.createElement("input");
    input.type = "text";
    input.className = "edit-input";
    input.value = docSnap.data().text;

    // 이벤트 연결
    editBtn.addEventListener("click", () => {
      span.style.display = "none";
      input.style.display = "block";
      input.focus();
    });

    saveBtn.addEventListener("click", () => saveEdit(docSnap.id, input, span));
    input.addEventListener("keydown", e => { if (e.key === "Enter") saveEdit(docSnap.id, input, span); });
    delBtn.addEventListener("click", () => deleteLetter(docSnap.id));

    li.appendChild(editBtn);
    li.appendChild(saveBtn);
    li.appendChild(delBtn);
    li.appendChild(span);
    li.appendChild(input);

    lettersList.appendChild(li);
  });
}

loadLetters();
</script>

</body>
</html>
