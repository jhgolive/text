<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>GPS 업로드</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  margin: 0;
  padding: 10px;
  font-family: sans-serif;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: #f0f0f0;
  text-align: center;
  user-select: none;
}
#status-text { 
  font-size: 24px; 
  font-weight: bold; 
  margin-bottom: 10px; 
}
.btn-row {
  display: flex;
  align-items: center;
  gap: 2px;
  margin-bottom: 2px;
}
.btn-label {
  font-size: 18px;
  width: 50px;
  text-align: right;
  font-weight: bold;
}
button {
  width: 80px;
  height: 80px;
  font-size: 36px;
  border: none;
  border-radius: 12px;
  background: #000033;
  color: #fff;
  cursor: pointer;
  user-select: none;
  transition: background 0.1s;
}
button.active {
  background: #000088;
}
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAQGtOEcxFxl9FV7NASLgxLDc23u2vzS_0",
  authDomain: "mygps-11798.firebaseapp.com",
  databaseURL: "https://mygps-11798-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "mygps-11798",
  storageBucket: "mygps-11798.firebasedestorage.app",
  messagingSenderId: "271371741627",
  appId: "1:271371741627:web:642901f43c5ad57d80bc9e"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.mapLevel = 4;
window.borderRadius = 0; 
window.mapOpacity = 1;
window.mapSize = 200;      
const MAX_RADIUS = 160;
const MIN_MOVE = 0.00005;
const MAX_SIZE = 600;
const MIN_SIZE = 100;

let prevPos = null;

function distance(lat1, lng1, lat2, lng2) {
  return Math.sqrt((lat2 - lat1)**2 + (lng2 - lng1)**2);
}

function uploadLocation(lat, lng) {
  set(ref(db, "location/current"), {
    lat, lng,
    level: window.mapLevel,
    borderRadius: window.borderRadius,
    opacity: window.mapOpacity,
    mapSize: window.mapSize,
    timestamp: Date.now()
  });
}

window.onload = function() {
  const zoomInBtn = document.getElementById('zoom-in');
  const zoomOutBtn = document.getElementById('zoom-out');
  const rounderInBtn = document.getElementById('rounder-in');
  const rounderOutBtn = document.getElementById('rounder-out');
  const opacityUpBtn = document.getElementById('opacityUp');
  const opacityDownBtn = document.getElementById('opacityDown');
  const sizeUpBtn = document.getElementById('size-up');
  const sizeDownBtn = document.getElementById('size-down');

  const opacityLabel = document.getElementById('opacity-label');
  const radiusLabel = document.getElementById('radius-label');
  const levelLabel = document.getElementById('level-label');
  const sizeLabel = document.getElementById('size-label');

  function updateDisplays() {
    opacityLabel.textContent = window.mapOpacity.toFixed(2);
    radiusLabel.textContent = window.borderRadius;
    levelLabel.textContent = window.mapLevel;
    sizeLabel.textContent = window.mapSize;
  }
  updateDisplays();

  const intervalDelay = 150;
  const startDelay = 500;
  const zoomIncrement = 1;
  const radiusIncrement = 10;
  const opacityIncrement = 0.05;
  const sizeIncrement = 20;

  function changeOpacity(delta) {
    window.mapOpacity = Math.min(1, Math.max(0.1, window.mapOpacity + delta));
    updateDisplays();
  }
  function changeRadius(delta) {
    window.borderRadius = Math.min(MAX_RADIUS, Math.max(0, window.borderRadius + delta));
    updateDisplays();
  }
  function changeZoom(delta) {
    window.mapLevel = Math.min(14, Math.max(1, window.mapLevel + delta));
    updateDisplays();
  }
  function changeMapSize(delta) {
    window.mapSize = Math.min(MAX_SIZE, Math.max(MIN_SIZE, window.mapSize + delta));
    updateDisplays();
  }

  function addHoldEvent(button, delta, func) {
    let interval = null;
    let timeout = null;
    let longPress = false;
    const startChange = () => {
      longPress = true;
      interval = setInterval(() => func(delta), intervalDelay);
    };
    button.addEventListener('mousedown', () => {
      longPress = false;
      timeout = setTimeout(startChange, startDelay);
    });
    button.addEventListener('mouseup', () => {
      clearTimeout(timeout);
      clearInterval(interval);
      if (!longPress) func(delta);
    });
    button.addEventListener('mouseleave', () => {
      clearTimeout(timeout);
      clearInterval(interval);
    });
    button.addEventListener('touchstart', (e) => {
      e.preventDefault();
      longPress = false;
      timeout = setTimeout(startChange, startDelay);
    });
    button.addEventListener('touchend', () => {
      clearTimeout(timeout);
      clearInterval(interval);
      if (!longPress) func(delta);
    });
  }

  addHoldEvent(opacityUpBtn, opacityIncrement, changeOpacity);
  addHoldEvent(opacityDownBtn, -opacityIncrement, changeOpacity);
  addHoldEvent(rounderInBtn, radiusIncrement, changeRadius);
  addHoldEvent(rounderOutBtn, -radiusIncrement, changeRadius);
  addHoldEvent(zoomInBtn, zoomIncrement, changeZoom);
  addHoldEvent(zoomOutBtn, -zoomIncrement, changeZoom);
  addHoldEvent(sizeUpBtn, sizeIncrement, changeMapSize);
  addHoldEvent(sizeDownBtn, -sizeIncrement, changeMapSize);

  const buttons = document.querySelectorAll('button');
  buttons.forEach(btn => {
    btn.addEventListener('mousedown', () => btn.classList.add('active'));
    btn.addEventListener('mouseup', () => btn.classList.remove('active'));
    btn.addEventListener('mouseleave', () => btn.classList.remove('active'));
    btn.addEventListener('touchstart', () => btn.classList.add('active'));
    btn.addEventListener('touchend', () => btn.classList.remove('active'));
    btn.addEventListener('touchcancel', () => btn.classList.remove('active'));
  });

  if(navigator.geolocation){
    navigator.geolocation.watchPosition(
      (pos) => {
        if(prevPos){
          const moveDist = distance(prevPos.lat, prevPos.lng, pos.coords.latitude, pos.coords.longitude);
          if(moveDist >= MIN_MOVE){
            prevPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          }
        } else {
          prevPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        }
        uploadLocation(pos.coords.latitude, pos.coords.longitude);
      },
      (err) => console.error(err),
      { enableHighAccuracy: true }
    );
  } else { alert("GPS를 지원하지 않는 기기입니다."); }
};
</script>
</head>
<body>
  <div id="status-text">GPS 업로드 중...</div>

  <div class="btn-row">
    <div class="btn-label" id="opacity-label">1.00</div>
    <button id="opacityUp">◆</button>
    <button id="opacityDown">◇</button>
  </div>

  <div class="btn-row">
    <div class="btn-label" id="radius-label">0</div>
    <button id="rounder-out">□</button>
    <button id="rounder-in">○</button>
  </div>

  <div class="btn-row">
    <div class="btn-label" id="size-label">200</div>
    <button id="size-up">+</button>
    <button id="size-down">-</button>
  </div>

  <div class="btn-row">
    <div class="btn-label" id="level-label">4</div>
    <button id="zoom-out"><></button>  
    <button id="zoom-in">><</button>   
  </div>
</body>
</html>


