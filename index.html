<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Letters ê´€ë¦¬</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #111;
      color: white;
    }
    
    input {
      padding: 10px;       /* ì…ë ¥ì°½ í„°ì¹˜ ì¹œí™”ì ìœ¼ë¡œ í‚¤ì›€ */
      margin-right: 5px;
      font-size: 16px;
      width: 60%;          /* ëª¨ë°”ì¼ í™”ë©´ì—ì„œ ì ë‹¹íˆ ë„“ê²Œ */
      max-width: 300px;
    }
    
    button {
      padding: 10px 15px;  /* ë²„íŠ¼ í„°ì¹˜ ì¹œí™”ì ìœ¼ë¡œ í‚¤ì›€ */
      margin-right: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    
    ul {
      list-style: none;
      padding: 0;
      margin-top: 20px;
    }
    
    li {
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;   /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ê³¼ í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ê°€ëŠ¥ */
      align-items: center;
    }
    
    li span {
      flex: 1 1 100%;    /* ëª¨ë°”ì¼ì—ì„œëŠ” spanì´ ì „ì²´ ë„ˆë¹„ ì°¨ì§€ */
      margin-bottom: 5px;
      word-break: break-word;  /* ê¸´ ê¸€ì ì¤„ë°”ê¿ˆ */
    }
    
    li button {
      margin-left: 0;
      margin-right: 5px;
      border: none;
      border-radius: 3px;
    }
    
    .delete-btn { background: red; color: white; }
    .edit-btn { background: #0a84ff; color: white; }
    
    /* ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ */
    @media (min-width: 480px) {
      li span { flex: 1; margin-bottom: 0; }  /* ë„“ì€ í™”ë©´ì—ì„œëŠ” ì›ë˜ëŒ€ë¡œ */
      li button { margin-left: 5px; }
    }
  </style>
</head>
<body>

<h2>Letters ê´€ë¦¬</h2>

<input type="text" id="letterInput" placeholder="ê¸€ì ì…ë ¥" />
<button id="addBtn">ë“±ë¡</button>

<ul id="lettersList"></ul>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // ğŸ”¹ Firebase ì„¤ì •
  const firebaseConfig = {
    apiKey: "AIzaSyAQGtOEcxFxl9FV7NASLgxLDc23u2vzS_0",
    authDomain: "mygps-11798.firebaseapp.com",
    projectId: "mygps-11798",
    storageBucket: "mygps-11798.firebasestorage.app",
    messagingSenderId: "271371741627",
    appId: "1:271371741627:web:642901f43c5ad57d80bc9e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const lettersCol = collection(db, "letters");
  const lettersList = document.getElementById("lettersList");

  // ğŸ”¹ ê¸€ì ë“±ë¡
  document.getElementById("addBtn").addEventListener("click", async () => {
    const text = document.getElementById("letterInput").value.trim();
    if (!text) return alert("ê¸€ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

    await addDoc(lettersCol, { 
      text, 
      timestamp: Date.now() // ë“±ë¡ ì‹œê°„ ì¶”ê°€
    });
    document.getElementById("letterInput").value = "";
    loadLetters();
  });

  // ğŸ”¹ ê¸€ì ì‚­ì œ
  async function deleteLetter(id) {
    await deleteDoc(doc(db, "letters", id));
    loadLetters();
  }

  // ğŸ”¹ ê¸€ì ìˆ˜ì • (timestamp ì—…ë°ì´íŠ¸ ì—†ìŒ)
  async function editLetter(id, oldText) {
    const newText = prompt("ìƒˆ ê¸€ìë¥¼ ì…ë ¥í•˜ì„¸ìš”:", oldText);
    if (newText && newText.trim() !== "") {
      await updateDoc(doc(db, "letters", id), { 
        text: newText.trim() // timestampëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
      });
      loadLetters();
    }
  }

  // ğŸ”¹ ê¸€ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ë“±ë¡ ìˆœì„œ ê¸°ì¤€)
  async function loadLetters() {
    lettersList.innerHTML = "";
    const q = query(lettersCol, orderBy("timestamp", "asc")); // ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
    const snapshot = await getDocs(q);
    snapshot.forEach(docSnap => {
      const li = document.createElement("li");
      const span = document.createElement("span");
      span.textContent = docSnap.data().text;

      const editBtn = document.createElement("button");
      editBtn.textContent = "ìˆ˜ì •";
      editBtn.className = "edit-btn";
      editBtn.addEventListener("click", () => editLetter(docSnap.id, docSnap.data().text));

      const delBtn = document.createElement("button");
      delBtn.textContent = "ì‚­ì œ";
      delBtn.className = "delete-btn";
      delBtn.addEventListener("click", () => deleteLetter(docSnap.id));

      li.appendChild(span);
      li.appendChild(editBtn);
      li.appendChild(delBtn);
      lettersList.appendChild(li);
    });
  }

  // ì´ˆê¸° ë¡œë“œ
  loadLetters();
</script>

</body>
</html>

