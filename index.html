<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Letters 관리 (모바일 최적화)</title>
<style>
body {
  font-family: Arial, sans-serif;
  padding: 15px;
  background: #111;
  color: white;
  margin: 0;
}

/* 입력 영역 */
.input-group {
  display: flex;
  flex-wrap: wrap;
  margin-bottom: 15px;
}
input#letterInput {
  flex: 1 1 auto;
  width: 50ch; /* 50글자 폭 */
  max-width: 100%;
  padding: 10px;
  font-size: 16px;
  box-sizing: border-box;
  border-radius: 4px;
  border: none;
}
button#addBtn {
  flex: 0 0 auto;
  padding: 10px 15px;
  font-size: 16px;
  margin-left: 5px;
  border-radius: 4px;
  border: none;
  background: #28a745;
  color: white;
  cursor: pointer;
}

/* 버튼 공통 */
button {
  font-size: 16px;
  padding: 8px 12px;
  margin: 2px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  min-width: 60px;
}

/* 글자 목록 */
ul {
  list-style: none;
  padding: 0;
  margin-top: 10px;
}
li {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
  background: #222;
  padding: 8px;
  border-radius: 6px;
  width: 100%;
  box-sizing: border-box;
}
li span {
  flex: 1 1 auto;
  word-break: break-word;
  margin-right: 10px;
  width: 50ch; /* 기본 폭 */
  max-width: 100%;
  display: inline-block;
}
li input.edit-input {
  width: 50ch;
  max-width: 100%;
  margin-right: 10px;
  display: none;
  padding: 8px;
  font-size: 16px;
  border-radius: 4px;
  border: none;
  box-sizing: border-box;
}

/* 버튼 색상 */
.edit-btn {
  background: #0a84ff;
  color: white;
}
.delete-btn {
  background: red;
  color: white;
}

/* 모바일 최적화 */
@media (max-width: 600px) {
  .input-group {
    flex-direction: column;
  }
  input#letterInput {
    width: 100%;
    margin-bottom: 8px;
  }
  button#addBtn {
    width: 100%;
    margin-left: 0;
  }
  li {
    flex-direction: column;
    align-items: stretch;
  }
  li span, li input.edit-input {
    width: 100%;
    margin-bottom: 8px;
  }
  li button {
    width: 100%;
    margin: 3px 0;
  }
}
</style>
</head>
<body>

<h2>Letters 관리</h2>

<div class="input-group">
  <input type="text" id="letterInput" placeholder="글자 입력"/>
  <button id="addBtn">등록</button>
</div>

<ul id="lettersList"></ul>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAQGtOEcxFxl9FV7NASLgxLDc23u2vzS_0",
  authDomain: "mygps-11798.firebaseapp.com",
  projectId: "mygps-11798",
  storageBucket: "mygps-11798.firebasestorage.app",
  messagingSenderId: "271371741627",
  appId: "1:271371741627:web:642901f43c5ad57d80bc9e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const lettersCol = collection(db, "letters");
const lettersList = document.getElementById("lettersList");

// 글자 등록
document.getElementById("addBtn").addEventListener("click", async () => {
  const text = document.getElementById("letterInput").value.trim();
  if (!text) return alert("글자를 입력하세요.");
  await addDoc(lettersCol, { text, timestamp: Date.now() });
  document.getElementById("letterInput").value = "";
  loadLetters();
});

// 글자 삭제
async function deleteLetter(id) {
  await deleteDoc(doc(db, "letters", id));
  loadLetters();
}

// 글자 수정/저장 토글
async function toggleEdit(id, spanEl, inputEl, btnEl) {
  const isEditing = inputEl.style.display === "block";

  if (!isEditing) {
    spanEl.style.display = "none";
    inputEl.style.display = "block";
    inputEl.focus();
    inputEl.setSelectionRange(0, inputEl.value.length);
    btnEl.textContent = "저장";
  } else {
    const newText = inputEl.value.trim();
    if (!newText) return;
    await updateDoc(doc(db, "letters", id), { text: newText });
    spanEl.textContent = newText;
    inputEl.style.display = "none";
    spanEl.style.display = "inline-block";
    btnEl.textContent = "수정";
  }
}

// 글자 목록 불러오기
async function loadLetters() {
  lettersList.innerHTML = "";
  const q = query(lettersCol, orderBy("timestamp", "asc"));
  const snapshot = await getDocs(q);
  snapshot.forEach(docSnap => {
    const li = document.createElement("li");

    const span = document.createElement("span");
    span.textContent = docSnap.data().text;

    const input = document.createElement("input");
    input.type = "text";
    input.className = "edit-input";
    input.value = docSnap.data().text;

    const editBtn = document.createElement("button");
    editBtn.textContent = "수정";
    editBtn.className = "edit-btn";

    const delBtn = document.createElement("button");
    delBtn.textContent = "삭제";
    delBtn.className = "delete-btn";

    // 이벤트 연결
    editBtn.addEventListener("click", () => toggleEdit(docSnap.id, span, input, editBtn));
    input.addEventListener("keydown", e => { if (e.key === "Enter") toggleEdit(docSnap.id, span, input, editBtn); });
    delBtn.addEventListener("click", () => deleteLetter(docSnap.id));

    li.appendChild(span);
    li.appendChild(input);
    li.appendChild(editBtn);
    li.appendChild(delBtn);

    lettersList.appendChild(li);
  });
}

loadLetters();
</script>

</body>
</html>
