<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Letters Í¥ÄÎ¶¨</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #111; color: white; }
    input { padding: 5px; margin-right: 5px; }
    button { padding: 5px 10px; margin-right: 5px; cursor: pointer; }
    ul { list-style: none; padding: 0; margin-top: 20px; }
    li { margin-bottom: 5px; display: flex; align-items: center; }
    li span { flex: 1; }
    li button { margin-left: 5px; border: none; border-radius: 3px; }
    .delete-btn { background: red; color: white; }
    .edit-btn { background: #0a84ff; color: white; }
  </style>
</head>
<body>

<h2>Letters Í¥ÄÎ¶¨</h2>

<input type="text" id="letterInput" placeholder="Í∏ÄÏûê ÏûÖÎ†•" />
<button id="addBtn">Îì±Î°ù</button>

<ul id="lettersList"></ul>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // üîπ Firebase ÏÑ§Ï†ï
  const firebaseConfig = {
    apiKey: "AIzaSyAQGtOEcxFxl9FV7NASLgxLDc23u2vzS_0",
    authDomain: "mygps-11798.firebaseapp.com",
    projectId: "mygps-11798",
    storageBucket: "mygps-11798.firebasestorage.app",
    messagingSenderId: "271371741627",
    appId: "1:271371741627:web:642901f43c5ad57d80bc9e"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const lettersCol = collection(db, "letters");
  const lettersList = document.getElementById("lettersList");

  // üîπ Í∏ÄÏûê Îì±Î°ù
  document.getElementById("addBtn").addEventListener("click", async () => {
    const text = document.getElementById("letterInput").value.trim();
    if (!text) return alert("Í∏ÄÏûêÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");

    await addDoc(lettersCol, { 
      text, 
      timestamp: Date.now() // Îì±Î°ù ÏãúÍ∞Ñ Ï∂îÍ∞Ä
    });
    document.getElementById("letterInput").value = "";
    loadLetters();
  });

  // üîπ Í∏ÄÏûê ÏÇ≠Ï†ú
  async function deleteLetter(id) {
    await deleteDoc(doc(db, "letters", id));
    loadLetters();
  }

  // üîπ Í∏ÄÏûê ÏàòÏ†ï (timestamp ÏóÖÎç∞Ïù¥Ìä∏ ÏóÜÏùå)
  async function editLetter(id, oldText) {
    const newText = prompt("ÏÉà Í∏ÄÏûêÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:", oldText);
    if (newText && newText.trim() !== "") {
      await updateDoc(doc(db, "letters", id), { 
        text: newText.trim() // timestampÎäî Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ
      });
      loadLetters();
    }
  }

  // üîπ Í∏ÄÏûê Î™©Î°ù Î∂àÎü¨Ïò§Í∏∞ (Îì±Î°ù ÏàúÏÑú Í∏∞Ï§Ä)
  async function loadLetters() {
    lettersList.innerHTML = "";
    const q = query(lettersCol, orderBy("timestamp", "asc")); // Ïò§Î¶ÑÏ∞®Ïàú Ï†ïÎ†¨
    const snapshot = await getDocs(q);
    snapshot.forEach(docSnap => {
      const li = document.createElement("li");
      const span = document.createElement("span");
      span.textContent = docSnap.data().text;

      const editBtn = document.createElement("button");
      editBtn.textContent = "ÏàòÏ†ï";
      editBtn.className = "edit-btn";
      editBtn.addEventListener("click", () => editLetter(docSnap.id, docSnap.data().text));

      const delBtn = document.createElement("button");
      delBtn.textContent = "ÏÇ≠Ï†ú";
      delBtn.className = "delete-btn";
      delBtn.addEventListener("click", () => deleteLetter(docSnap.id));

      li.appendChild(span);
      li.appendChild(editBtn);
      li.appendChild(delBtn);
      lettersList.appendChild(li);
    });
  }

  // Ï¥àÍ∏∞ Î°úÎìú
  loadLetters();
</script>

</body>
</html>
